{% extends "auctions/layout.html" %}

{% block body %}

    {% if message %}
        <div class="alert alert-info" role="alert" style="font-weight: 500;">
            {{ message }}
        </div>
    {% endif %}

    <div class="mb-3">
        {% if user.is_authenticated %}
            {% if listing.owner == user %}
                <form action="{% url 'close_listing' listing.id %}" method="POST" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-danger" style="border-radius: 20px;">üõë Close Listing</button>
                </form>
            {% endif %}

            {% if is_in_watchlist %}
                <form action="{% url 'remove_from_watchlist' listing.id %}" method="POST" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-warning" style="border-radius: 20px;">‚≠ê Remove from Watchlist</button>
                </form>
            {% else %}
                <form action="{% url 'add_to_watchlist' listing.id %}" method="POST" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-success" style="border-radius: 20px;">‚≠ê Add to Watchlist</button>
                </form>
            {% endif %}
        {% endif %}
    </div>

    <div class="mb-4">
        <h2 style="color: #4B0082; font-weight: bold;">üìò Book: {{ listing.title }}</h2>
        <img src="{{ listing.image_url }}" alt="{{ listing.title }}" class="img-fluid mb-3"
             style="max-height: 400px; object-fit: cover; border-radius: 10px;">
        <p style="font-size: 1.1rem;"><strong>Description:</strong> {{ listing.description }}</p>
        <h4 style="color: green; font-weight: bold;">Price: ‚Çπ{{ listing.price }}</h4>
        <p><strong>Owner:</strong> {{ listing.owner }}</p>
    </div>

    <!-- Bidding Section -->
    <div class="row mb-5">
        <div class="col-md-6">
            <div style="background-color: #f8f9fa; padding: 20px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
                <h3 style="color: #4B0082;">üí∞ Place a Bid</h3>
                {% if user.is_authenticated %}
                    <form action="{% url 'place_bid' listing.id %}" method="POST">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="bid_amount"><strong>Bid Amount (‚Çπ):</strong></label>
                            <input type="number" class="form-control" id="bid_amount" name="bid_amount"
                                   min="{{ listing.price }}" step="0.01" required>
                        </div>
                        <button type="submit" class="btn btn-primary mt-2" style="border-radius: 20px;">Place Bid</button>
                    </form>
                {% else %}
                    <p class="text-muted">You must be logged in to place a bid.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Comment Section -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div style="background-color: #fefefe; padding: 20px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
                <h3 style="color: #4B0082;">üí¨ Write Your Comments</h3>
                {% if user.is_authenticated %}
                    <form action="{% url 'add_comment' listing.id %}" method="POST">
                        {% csrf_token %}
                        <div class="form-group">
                            <textarea class="form-control" name="comment" rows="3" placeholder="Add a comment..." required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="border-radius: 20px;">Submit</button>
                    </form>
                {% else %}
                    <p class="text-muted">You must be logged in to comment.</p>
                {% endif %}

                <ul class="list-group mt-4">
                    <h5 class="mb-2">üó®Ô∏è Comments</h5>
                    {% for comment in comments %}
                        <li class="list-group-item" style="border-left: 4px solid #4B0082;">
                            <strong>{{ comment.writer }}:</strong> {{ comment.content }}
                            <span class="text-muted float-right" style="font-size: 0.85em;">{{ comment.created_at|date:"Y-m-d H:i" }}</span>
                        </li>
                    {% empty %}
                        <li class="list-group-item text-muted">No comments yet.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

{% endblock %}
